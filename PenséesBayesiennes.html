<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Statistique Bayésienne — Blog de l'intranquilité</title>

  <!-- Polices -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=Merriweather:wght@300;700&display=swap" rel="stylesheet">

  <!-- MathJax -->
  <script>
    window.MathJax = {
      tex: {inlineMath: [['$','$'], ['\\(','\\)']], displayMath: [['$$','$$'], ['\\[','\\]']]},
      svg: {fontCache: 'global'}
    };
  </script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js" defer></script>

  <!-- Chart.js (pour le visualiseur) -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

  <style>
    :root{
      --maxw:900px;
      --bg: #f6f8fb;
      --card: #ffffff;
      --text: #0f1724;
      --muted: #6b7280;
      --accent: #8b0000;
      --accent-dark: #7a0000;
      --radius:14px;
      --gap:20px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background:linear-gradient(180deg,var(--bg),#ffffff 40%);
      color:var(--text);
      font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      line-height:1.6;
      padding:24px 16px 48px;
    }

    /* --- Bandeau : adapté pour ressembler au script "Libres pensées" --- */
    header{
      background:#8b0000;
      border-bottom:1px solid #7a0000;
      color:#fff;
    }
    .wrap{
      max-width:var(--maxw);
      margin:0 auto;
      padding:18px 20px;
      display:flex;
      align-items:center;
      justify-content:space-between;
    }
    h1{
      margin:0;
      font-family:Merriweather,serif;
      font-size:20px;
      font-weight:700;
      color:#fff;
    }
    nav{display:flex;gap:12px;align-items:center}
    nav a{color:#f3f4f6;text-decoration:none;font-size:14px}
    nav a:hover{text-decoration:underline}

    /* Main card */
    main{max-width:var(--maxw);margin:0 auto}
    .card{
      background:var(--card);
      border-radius:var(--radius);
      padding:22px;
      box-shadow:0 6px 18px rgba(15,23,36,0.05);
      margin-bottom:18px;
    }

    h2{font-family:Merriweather, serif;margin:0 0 10px;font-size:20px;color:var(--text)}
    p{margin:0 0 12px;color:var(--text);font-size:16px}
    .muted{color:var(--muted);font-size:14px}

    /* math block */
    .math-block{
      padding:14px;
      margin:12px 0;
      border-radius:12px;
      background:linear-gradient(180deg,#fff,#fbfbfd);
      border:1px solid #eef2f7;
      font-size:18px;
    }
    .math-caption{font-size:13px;color:var(--muted);margin-top:8px}

    /* definition list */
    dl{display:grid;grid-template-columns:120px 1fr;gap:8px 18px;align-items:start;margin:10px 0 0}
    dt{font-weight:600;color:var(--text);font-size:15px}
    dd{margin:0;color:var(--muted);font-size:15px}

    /* example box */
    .example{
      border-left:4px solid var(--accent);
      background:linear-gradient(180deg,#fff,#fffaf6);
      padding:12px 14px;
      border-radius:8px;
      margin-top:12px;
    }

    footer{max-width:var(--maxw);margin:22px auto 0;text-align:center;font-size:14px;color:var(--muted)}
    a.skip-link{position:absolute;left:12px;top:12px;padding:8px 12px;background:#000;color:#fff;border-radius:6px;z-index:100;transform:translateY(-150%);transition:transform .15s ease;text-decoration:none}
    a.skip-link:focus{transform:translateY(0)}

    /* Responsive tweaks */
    @media (max-width:640px){
      dl{grid-template-columns:1fr}
      header{padding:14px}
      .card{padding:16px}
    }

    /* ========== Styles scoped pour le visualiseur ========== */
    /* Préfixe .viz pour éviter conflits avec le style du blog */
    .viz .app{max-width:1100px;margin:0 auto;display:grid;grid-template-columns:380px 1fr;gap:20px}
    .viz .card{background:linear-gradient(180deg,#0b1220, #071827);border:1px solid rgba(255,255,255,0.04);padding:18px;border-radius:12px;box-shadow:0 6px 18px rgba(2,6,23,0.6);color:#e6eef3}
    .viz h1{font-size:18px;margin:0 0 12px;color:#e6eef3}
    .viz label{display:block;font-size:13px;color:#9aa7b2;margin:10px 0 6px}
    .viz select,.viz input,.viz textarea{width:100%;padding:8px 10px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:inherit}
    .viz .params{margin-top:6px}
    .viz .row{display:flex;gap:8px}
    .viz .row>div{flex:1}
    .viz .small{font-size:12px;color:#9aa7b2}
    .viz .btn{display:inline-block;margin-top:12px;padding:8px 12px;border-radius:8px;background:#0ea5a4;color:#012;cursor:pointer;border:none}
    .viz canvas{background:linear-gradient(180deg, rgba(255,255,255,0.015), rgba(255,255,255,0.01));border-radius:12px;display:block;width:100%}
    .viz footer{margin-top:12px;font-size:12px;color:#9aa7b2}
    .viz .help{margin-top:10px;font-size:13px;color:#9aa7b2}

    /* small responsive for viz */
    @media (max-width:900px){
      .viz .app{grid-template-columns:1fr}
    }
  </style>
</head>
<body>
  <a class="skip-link" href="#main">Aller au contenu</a>

  <header>
    <div class="wrap">
      <h1>Blog de l'intranquilité</h1>
      <nav aria-label="Navigation principale">
        <a href="index.html">Accueil</a>
        <a href="culture-films.html">Films</a>
        <a href="culture-livres.html">Livres</a>
        <a href="culture-musiques.html">Musiques</a>
        <a href="projets-libres-pensees.html">Projets</a>
      </nav>
    </div>
  </header>

  <main id="main">
    <article class="card" role="article" aria-labelledby="titre">
      <h2 id="titre">Statistique bayésienne</h2>

      <p class="muted">La statistique bayésienne traite le paramètre inconnu comme une quantité aléatoire et met à jour la croyance sur ce paramètre après observation des données.</p>

      <p>
        On part d'une <strong>loi a priori</strong> $\pi(\theta)$ qui exprime notre connaissance (ou ignorance) sur $\theta$
        avant d'observer les données. La <strong>vraisemblance</strong> $p(x\mid\theta)$ est la probabilité (ou densité) d'observer les données $x$
        si le paramètre valait $\theta$. La <strong>loi a posteriori</strong> $p(\theta\mid x)$ est la mise à jour de la croyance sur $\theta$ après avoir vu $x$.
      </p>

      <div class="math-block" role="figure" aria-label="Formule de Bayes : densité a posteriori">
        \[
          p(\theta\mid x)\;=\;\frac{p(x\mid\theta)\,\pi(\theta)}{\displaystyle\int_{\Theta} p(x\mid\tau)\,\pi(\tau)\,d\tau}.
        \]
      </div>

      <dl>
        <dt>\(\theta\)</dt>
        <dd>Paramètre du modèle (ex. probabilité de succès, moyenne). En bayésien, on le modélise par une variable aléatoire.</dd>

        <dt>\(\pi(\theta)\)</dt>
        <dd>La loi a priori — exprime notre connaissance (ou ignorance) du paramètre $\theta$ avant d'avoir observé les données. </dd>

        <dt>\(p(x\mid\theta)\)</dt>
        <dd>La vraisemblance — la probabilité d'observer les données x si le paramètre valait theta. (C'est la fonction qui lie le modèle aux observations.)</dd>

        <dt>\(p(\theta\mid x)\)</dt>
        <dd>La loi a posteriori — la loi a posteriori (posterior), mise à jour de la croyance sur théta après avoir vu les données x. </dd>
      </dl>

    </article>

    <!-- ----- Visualiseur incorporé ----- -->
    <section class="card viz" aria-labelledby="viz-title">
      <h2 id="viz-title" style="margin-top:0">Lois de probabilité. </h2>

      <div class="app" style="margin-top:12px">
        <div class="card" style="padding:14px;">
          <div>
            <label for="dist">Choisir une loi</label>
            <select id="dist">
              <option value="normal">Normale (continue)</option>
              <option value="cauchy">Cauchy (continue)</option>
              <option value="student">Student t (continue)</option>
              <option value="chi2">Chi-2 (χ², continue)</option>
              <option value="f">Fisher F (continue)</option>
              <option value="exponential">Exponentielle (continue)</option>
              <option value="uniform">Uniforme (continue)</option>
              <option value="gamma">Gamma (continue)</option>
              <option value="beta">Bêta (continue sur [0,1])</option>
              <option value="poisson">Poisson (discrète)</option>
            </select>
          </div>

          <div id="params" class="params"></div>

          <label for="range">Plage x (min — max)</label>
          <div class="row">
            <div><input id="xmin" type="number" step="any" value="-5"></div>
            <div><input id="xmax" type="number" step="any" value="5"></div>
          </div>

          <label for="resolution">Résolution </label>
          <input id="resolution" type="number" min="20" max="2000" value="300" />

          <button id="plotBtn" class="btn">Tracer</button>
          <button id="autoBtn" class="btn" style="background:#536878;margin-left:8px">Auto-plage</button>

      
        </div>

        <div class="card" style="padding:10px;">
          <canvas id="chart" height="380" aria-label="Graphique des densités ou PMF" role="img"></canvas>
        </div>
      </div>
    </section>

    <!-- ========== Deuxième partie du script (statistique fréquentiste / p-value) ========== -->

    <section class="card" aria-labelledby="freq-title">
      <article>
        <h1 id="freq-title">Statistique fréquentiste</h1>
        <h2>Statistique fréquentiste</h2>
        <p><strong>Définition : </strong>La <em>p-value</em> est la probabilité, supposant que l'hypothèse nulle $H_0$ soit vraie, d'observer une statistique de test $T$ aussi extrême que la valeur observée $t_{obs}$.</p> 
        <p>Formellement (unilatéral droit) : $$\text{p-value} = P_{H_0}\big(T(X) \ge t_{obs}\big).$$ Pour un test bilatéral on prend généralement : $$\text{p-value}_{bilat.} = 2\,P_{H_0}\big(T(X) \ge |t_{obs}|\big).$$ </p> 
        <div class="section">
           <h2>Comment calculer une p-value en pratique — étapes</h2> 
           <ol> 
            <li><strong>Spécifier l'hypothèse nulle $H_0$</strong> et la statistique de test $T$.</li>
            <li><strong>Calculer la statistique observée</strong> $t_{obs}$ à partir des données.</li> 
            <li><strong>Connaître la loi de $T$ sous $H_0$</strong> </li>
            <li><strong>Calculer la probabilité d'obtenir une valeur aussi extrême</strong> selon l'alternative choisie : intégrer/sommer les probabilités des queues de la distribution de $T$ sous $H_0$.</li>
            <li><strong>Interpréter</strong> : si p-value &lt; seuil $\alpha$ (ex. 0.05) on rejette $H_0$.</li> 
          </ol> </div> <div class="section"> <h2>Exemples</h2> <p><strong>Test z (approx normale) :</strong> si $Z\sim \mathcal{N}(0,1)$ et on observe $z_{obs}$, $$\text{p-value (bilat.)} = 2\big(1-\Phi(|z_{obs}|)\big),$$ où $\Phi$ est la fonction de répartition de la loi normale standard.</p> 
          </div> 
          <div class="section"> <h2>Graphe, loi normale standard</h2> 
            <p>Saisis une valeur z ci-dessous pour visualiser la zone qui donne la p-value, la figure suppose $Z\sim\mathcal{N}(0,1)$ sous $H_0$ .</p> 
            <div class="controls"> <label for="z">z =</label> <input id="z" type="number" step="0.1" value="1.6"> <label for="alt">Alternative</label> <select id="alt"> <option value="two">bilatéral</option> <option value="greater">unilatéral (&gt;)</option> <option value="less">unilatéral (&lt;)</option> 
            </select> <button id="draw">Dessiner</button> </div> <canvas id="plot" style="width:100%;height:160px;display:block;margin-top:8px"></canvas>
             <div id="pval" style="margin-top:8px"></div> 
          </div>
        </div>
      </article>
    </section>

  </main>

  <footer>
    © <span id="year"></span> — Blog personnel — <span style="color:var(--muted)"></span>
  </footer>

  <script>
    // année courante
    document.getElementById('year').textContent = new Date().getFullYear();
  </script>

  <!-- ================== Script du visualiseur (adapté & scoping) ================== -->
  <script>
    // --- Utilitaires mathématiques (Gamma de Lanczos pour fonctions Gamma/Beta/factorielle) ---
    function gamma(z) {
      const p = [676.5203681218851, -1259.1392167224028, 771.32342877765313,
        -176.61502916214059, 12.507343278686905, -0.13857109526572012,
        9.9843695780195716e-6, 1.5056327351493116e-7];
      if (z < 0.5) {
        return Math.PI / (Math.sin(Math.PI * z) * gamma(1 - z));
      }
      z -= 1;
      let x = 0.99999999999980993;
      for (let i = 0; i < p.length; i++) x += p[i] / (z + i + 1);
      const t = z + p.length - 0.5;
      return Math.sqrt(2 * Math.PI) * Math.pow(t, z + 0.5) * Math.exp(-t) * x;
    }
    function betaFunc(a,b){return gamma(a)*gamma(b)/gamma(a+b);} 

    // --- Densités / PMF ---
    const pdfs = {
      normal: (x, params) => {
        const mu = params.mu;
        const sigma = params.sigma;
        const z = (x - mu) / sigma;
        return (1 / (sigma * Math.sqrt(2 * Math.PI))) * Math.exp(-0.5 * z * z);
      },
      cauchy: (x, params) => {
        const x0 = params.x0, gamma = params.gamma;
        return (1/Math.PI) * (gamma / (Math.pow(x - x0, 2) + gamma*gamma));
      },
      student: (x, params) => {
        const nu = params.nu;
        const A = gamma((nu+1)/2) / (Math.sqrt(nu*Math.PI) * gamma(nu/2));
        return A * Math.pow(1 + x*x/nu, -(nu+1)/2);
      },
      chi2: (x, params) => {
        const k = params.k;
        if (x < 0) return 0;
        return Math.pow(x, k/2 - 1) * Math.exp(-x/2) / (Math.pow(2, k/2) * gamma(k/2));
      },
      f: (x, params) => {
        const d1 = params.d1, d2 = params.d2;
        if (x < 0) return 0;
        const num = Math.pow(d1/d2, d1/2) * Math.pow(x, d1/2 - 1);
        const den = betaFunc(d1/2, d2/2) * Math.pow(1 + (d1/d2)*x, (d1 + d2)/2);
        return num / den;
      },
      exponential: (x, params) => {
        const lambda = params.lambda;
        return x < 0 ? 0 : lambda * Math.exp(-lambda * x);
      },
      uniform: (x, params) => {
        const a = params.a, b = params.b;
        if (b <= a) return 0;
        return x < a || x > b ? 0 : 1 / (b - a);
      },
      gamma: (x, params) => {
        const k = params.k, theta = params.theta;
        if (x < 0) return 0;
        return Math.pow(x, k - 1) * Math.exp(-x / theta) / (gamma(k) * Math.pow(theta, k));
      },
      beta: (x, params) => {
        const a = params.alpha, b = params.beta;
        if (x < 0 || x > 1) return 0;
        return Math.pow(x, a - 1) * Math.pow(1 - x, b - 1) / betaFunc(a, b);
      },
      poisson: (k, params) => {
        const lambda = params.lambda;
        if (k < 0 || Math.round(k) !== k) return 0;
        return Math.pow(lambda, k) * Math.exp(-lambda) / gamma(k + 1);
      }
    };

    // --- DOM & UI ---
    const distSel = document.getElementById('dist');
    const paramsDiv = document.getElementById('params');
    const xminInput = document.getElementById('xmin');
    const xmaxInput = document.getElementById('xmax');
    const resInput = document.getElementById('resolution');
    const plotBtn = document.getElementById('plotBtn');
    const autoBtn = document.getElementById('autoBtn');

    function createParamInput(id, label, type='number', defaultValue=''){
      const wrapper = document.createElement('div');
      wrapper.style.marginTop = '8px';
      const lab = document.createElement('label'); lab.textContent = label; lab.className='small'; lab.htmlFor=id;
      const inp = document.createElement('input'); inp.type=type; inp.id=id; inp.value = defaultValue; inp.step='any';
      wrapper.appendChild(lab); wrapper.appendChild(inp);
      return {wrapper, inp};
    }

    function renderParams(){
      paramsDiv.innerHTML='';
      const d = distSel.value;
      if (d === 'normal'){
        const mu = createParamInput('mu','Mu (moyenne)', 'number', '0');
        const sigma = createParamInput('sigma','Sigma (écart-type)', 'number', '1');
        paramsDiv.appendChild(mu.wrapper); paramsDiv.appendChild(sigma.wrapper);
      } else if (d === 'cauchy'){
        const x0 = createParamInput('x0','x0', 'number', '0');
        const gamma = createParamInput('gamma','gamma (échelle, >0)', 'number', '1');
        paramsDiv.appendChild(x0.wrapper); paramsDiv.appendChild(gamma.wrapper);
      } else if (d === 'student'){
        const nu = createParamInput('nu','nu (degrés de liberté, >0)', 'number', '5');
        paramsDiv.appendChild(nu.wrapper);
      } else if (d === 'chi2'){
        const k = createParamInput('k','k (df, >0)', 'number', '4');
        paramsDiv.appendChild(k.wrapper);
      } else if (d === 'f'){
        const d1 = createParamInput('d1','d1 (df num., >0)', 'number', '5');
        const d2 = createParamInput('d2','d2 (df den., >0)', 'number', '10');
        paramsDiv.appendChild(d1.wrapper); paramsDiv.appendChild(d2.wrapper);
      } else if (d === 'exponential'){
        const lambda = createParamInput('lambda','Lambda (taux, >0)', 'number', '1');
        paramsDiv.appendChild(lambda.wrapper);
      } else if (d === 'uniform'){
        const a = createParamInput('a','a (min)', 'number', '0');
        const b = createParamInput('b','b (max)', 'number', '1');
        paramsDiv.appendChild(a.wrapper); paramsDiv.appendChild(b.wrapper);
      } else if (d === 'gamma'){
        const k = createParamInput('k','k (forme, >0)', 'number', '2');
        const theta = createParamInput('theta','θ (échelle, >0)', 'number', '2');
        paramsDiv.appendChild(k.wrapper); paramsDiv.appendChild(theta.wrapper);
      } else if (d === 'beta'){
        const alpha = createParamInput('alpha','α (alpha, >0)', 'number', '2');
        const beta = createParamInput('beta','β (beta, >0)', 'number', '5');
        paramsDiv.appendChild(alpha.wrapper); paramsDiv.appendChild(beta.wrapper);
      } else if (d === 'poisson'){
        const lambda = createParamInput('lambda_p','Lambda (moyenne, >0)', 'number', '3');
        paramsDiv.appendChild(lambda.wrapper);
      }
    }

    distSel.addEventListener('change', ()=>{ renderParams(); });
    renderParams();

    // --- Chart.js setup ---
    const ctx = document.getElementById('chart').getContext('2d');
    let chart = new Chart(ctx, {
      type: 'line',
      data: { labels: [], datasets: [{ label: 'Densité', data: [], fill: true, tension:0.25 }] },
      options: {
        responsive:true,
        plugins: { legend: { color: '#cfeff0' } },
        scales: {
          x: { type: 'linear', title:{display:true,text:'x'} },
          y: { title:{display:true,text:'f(x) / P(k)'} }
        }
      }
    });

    function readParams(){
      const d = distSel.value;
      if (d === 'normal') return {mu: parseFloat(document.getElementById('mu').value||0), sigma: Math.abs(parseFloat(document.getElementById('sigma').value||1))||1};
      if (d === 'cauchy') return {x0: parseFloat(document.getElementById('x0').value||0), gamma: Math.max(1e-9, Math.abs(parseFloat(document.getElementById('gamma').value||1)))};
      if (d === 'student') return {nu: Math.max(1e-9, parseFloat(document.getElementById('nu').value||1))};
      if (d === 'chi2') return {k: Math.max(1e-9, parseFloat(document.getElementById('k').value||1))};
      if (d === 'f') return {d1: Math.max(1e-9, parseFloat(document.getElementById('d1').value||1)), d2: Math.max(1e-9, parseFloat(document.getElementById('d2').value||1))};
      if (d === 'exponential') return {lambda: Math.max(1e-9, parseFloat(document.getElementById('lambda').value||1))};
      if (d === 'uniform') return {a: parseFloat(document.getElementById('a').value||0), b: parseFloat(document.getElementById('b').value||1)};
      if (d === 'gamma') return {k: Math.max(1e-9, parseFloat(document.getElementById('k').value||1)), theta: Math.max(1e-9, parseFloat(document.getElementById('theta').value||1))};
      if (d === 'beta') return {alpha: Math.max(1e-9, parseFloat(document.getElementById('alpha').value||1)), beta: Math.max(1e-9, parseFloat(document.getElementById('beta').value||1))};
      if (d === 'poisson') return {lambda: Math.max(1e-9, parseFloat(document.getElementById('lambda_p').value||1))};
    }

    function autoRange(){
      const d = distSel.value;
      const p = readParams();
      if (d === 'normal'){
        const mu = p.mu, sigma = p.sigma;
        xminInput.value = (mu - 4 * sigma).toFixed(4);
        xmaxInput.value = (mu + 4 * sigma).toFixed(4);
      } else if (d === 'cauchy'){
        xminInput.value = (p.x0 - 10*p.gamma).toFixed(4); xmaxInput.value = (p.x0 + 10*p.gamma).toFixed(4);
      } else if (d === 'student'){
        xminInput.value = (-6).toFixed(4); xmaxInput.value = (6).toFixed(4);
      } else if (d === 'chi2'){
        xminInput.value = 0; xmaxInput.value = Math.max(5, (p.k + 6*Math.sqrt(p.k)).toFixed(4));
      } else if (d === 'f'){
        xminInput.value = 0; xmaxInput.value = 10;
      } else if (d === 'exponential'){
        xminInput.value = 0; xmaxInput.value = (Math.log(1000)/p.lambda).toFixed(4);
      } else if (d === 'uniform'){
        xminInput.value = p.a; xmaxInput.value = p.b;
      } else if (d === 'gamma'){
        xminInput.value = 0; xmaxInput.value = (Math.max(5, p.k + 6 * Math.sqrt(p.k) * p.theta)).toFixed(4);
      } else if (d === 'beta'){
        xminInput.value = 0; xmaxInput.value = 1;
      } else if (d === 'poisson'){
        const lam = p.lambda; xminInput.value = 0; xmaxInput.value = Math.max(10, Math.ceil(lam + 6 * Math.sqrt(lam)));
      }
    }

    autoBtn.addEventListener('click', ()=>{ autoRange(); });

    function plot(){
      const d = distSel.value;
      const params = readParams();
      const xmin = parseFloat(xminInput.value);
      const xmax = parseFloat(xmaxInput.value);
      const res = Math.min(2000, Math.max(20, parseInt(resInput.value)||300));
      if (isNaN(xmin) || isNaN(xmax) || xmin >= xmax){ alert('Plage x invalide (min < max requis)'); return; }

      if (d === 'poisson'){
        const kmin = Math.max(0, Math.ceil(xmin));
        const kmax = Math.floor(xmax);
        const labels = [];
        const data = [];
        for (let k = kmin; k <= kmax; k++){
          labels.push(k);
          data.push(pdfs.poisson(k, params));
        }
        chart.destroy();
        chart = new Chart(ctx, {
          type: 'bar',
          data: { labels: labels, datasets: [{ label: 'PMF (Poisson)', data: data }] },
          options: { responsive:true, scales: { x:{ title:{display:true,text:'k'} }, y:{ title:{display:true,text:'P(k)'} } } }
        });
        return;
      }

      const xs = [];
      const ys = [];
      for (let i=0;i<res;i++){
        const t = i/(res-1);
        const x = xmin + t*(xmax-xmin);
        xs.push(x);
        const y = pdfs[d](x, params);
        ys.push(y);
      }

      // Chart.js expects objects if parsing keys used; build dataset accordingly
      const dataPoints = xs.map((xx, i) => ({x: xx, y: ys[i]}));

      chart.destroy();
      chart = new Chart(ctx, {
        type: 'line',
        data: { datasets: [{ label: 'Densité', data: dataPoints, fill:true, tension:0.2 }] },
        options: {
          responsive:true,
          parsing: { xAxisKey: 'x', yAxisKey: 'y' },
          plugins: { legend: { display:false } },
          scales: {
            x: { type:'linear', title:{display:true,text:'x'} },
            y: { title:{display:true,text:'f(x)'} }
          }
        }
      });
    }

    plotBtn.addEventListener('click', ()=>{ try{ plot(); } catch(e){ alert('Erreur: '+e.message); } });

    // initial auto-range & plot
    autoRange(); plot();
  </script>

  <!-- ================== Deuxième partie: script p-value (sans déformation) ========== -->
  <script>
  // fonctions normales
  function erf(x){
    const a1=0.254829592,a2=-0.284496736,a3=1.421413741,a4=-1.453152027,a5=1.061405429,p=0.3275911;
    const sign = x<0?-1:1; const absx=Math.abs(x);
    const t = 1/(1+p*absx);
    const y = 1 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*Math.exp(-absx*absx);
    return sign*y;
  }
  function normalCdf(x){ return 0.5*(1+erf(x/Math.sqrt(2))); }
  function normalPdf(x){ return Math.exp(-0.5*x*x)/Math.sqrt(2*Math.PI); }

  function draw(){
    const z = Number(document.getElementById('z').value) || 0;
    const alt = document.getElementById('alt').value;
    const canvas = document.getElementById('plot');
    const ctx = canvas.getContext('2d');
    const DPR = devicePixelRatio || 1;
    const W = canvas.clientWidth * DPR; const H = 160 * DPR;
    canvas.width = W; canvas.height = H;
    ctx.clearRect(0,0,W,H);
    const xmin=-4,xmax=4,n=400; const xs=[], ys=[]; let ymax=0;
    for(let i=0;i<n;i++){ const x = xmin + (xmax-xmin)*i/(n-1); const y=normalPdf(x); xs.push(x); ys.push(y); if(y>ymax) ymax=y; }
    // axes
    ctx.beginPath(); ctx.moveTo(0,H-20); ctx.lineTo(W,H-20); ctx.strokeStyle='#cbd5e1'; ctx.stroke();
    // pdf
    ctx.beginPath(); for(let i=0;i<n;i++){ const x=(xs[i]-xmin)/(xmax-xmin)*W; const y=H-20-(ys[i]/ymax)*(H-40); if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y); }
    ctx.lineWidth=2*DPR; ctx.strokeStyle='#0b1220'; ctx.stroke();
    // shading helper
    function shade(xstart,xend){ ctx.beginPath(); const i0=Math.max(0,Math.floor((xstart-xmin)/(xmax-xmin)*(n-1))); const i1=Math.min(n-1,Math.ceil((xend-xmin)/(xmax-xmin)*(n-1))); ctx.moveTo((xs[i0]-xmin)/(xmax-xmin)*W, H-20); for(let i=i0;i<=i1;i++){ const x=(xs[i]-xmin)/(xmax-xmin)*W; const y=H-20-(ys[i]/ymax)*(H-40); ctx.lineTo(x,y);} ctx.lineTo((xs[i1]-xmin)/(xmax-xmin)*W, H-20); ctx.closePath(); ctx.fillStyle='rgba(59,130,246,0.2)'; ctx.fill(); }
    if(alt==='greater'){ shade(z,xmax); const p = 1-normalCdf(z); document.getElementById('pval').innerHTML=`<strong>p-value (unilat. '>') =</strong> ${p.toExponential(3)}`; }
    else if(alt==='less'){ shade(xmin,z); const p = normalCdf(z); document.getElementById('pval').innerHTML=`<strong>p-value (unilat. '<') =</strong> ${p.toExponential(3)}`; }
    else{ shade(xmin,-Math.abs(z)); shade(Math.abs(z),xmax); const p = 2*(1-normalCdf(Math.abs(z))); document.getElementById('pval').innerHTML=`<strong>p-value (bilat.) =</strong> ${p.toExponential(3)}`; }
    // vertical line
    ctx.beginPath(); const zx=(z-xmin)/(xmax-xmin)*W; ctx.moveTo(zx,5); ctx.lineTo(zx,H-20); ctx.strokeStyle='#ef4444'; ctx.lineWidth=1.5*DPR; ctx.stroke(); ctx.font=`${12*DPR}px sans-serif`; ctx.fillStyle='#0b1220'; ctx.fillText('z = ' + z.toFixed(2), 8*DPR, 14*DPR);
  }
  document.getElementById('draw').addEventListener('click', draw);
  window.addEventListener('load', draw);
  </script>

  <script>
  function ensureMathJax(){
  if(window.MathJax && MathJax.typesetPromise){
    MathJax.typesetPromise().catch(function(err){ console.warn('MathJax typeset error:', err); });
  } else {
    var tries = 0;
    var id = setInterval(function(){
      tries++;
      if(window.MathJax && MathJax.typesetPromise){ MathJax.typesetPromise().catch(function(err){ console.warn('MathJax typeset error:', err); }); clearInterval(id); }
      if(tries > 15) clearInterval(id);
    }, 200);
  }
  }
  document.addEventListener('DOMContentLoaded', ensureMathJax);
  window.addEventListener('load', ensureMathJax);
  </script>

</body>
</html>

