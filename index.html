<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Blog de l'intranquilité</title>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=Merriweather:wght@300;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#ffffff;
      --text:#111827;
      --muted:#6b7280;
      --accent:#1f2937;
      --maxw:760px;
      --accent-cta:#8b0000;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,Arial;line-height:1.7}
    a{color:var(--accent);text-decoration:none}
    a:hover{text-decoration:underline}

    header{
      background:var(--accent-cta); /* bandeau rouge sobre */
      border-bottom:1px solid #7a0000;
    }
    .wrap{max-width:var(--maxw);margin:0 auto;padding:24px 20px}
    .top{display:flex;align-items:center;justify-content:space-between;gap:16px}
    h1{
      margin:0;
      font-family:Merriweather,serif;
      font-size:22px;
      font-weight:700;
      color:#ffffff;
    }

    nav{
      display:flex;
      gap:14px;
      align-items:center;
    }
    nav>a,
    nav .culture-btn,
    nav .projets-btn{
      font-size:14px;
      color:#f3f4f6;
    }
    nav>a:hover,
    nav .culture-btn:hover,
    nav .projets-btn:hover{
      text-decoration:underline;
    }
    nav>a{font-size:14px;color:var(--muted)}

    /* Dropdown menus */
    .menu-culture,.menu-projets{position:relative}
    .culture-dropdown,.projets-dropdown{
      display:none;
      position:absolute;
      top:100%;
      left:0;
      background:#ffffff;
      border:1px solid #e5e7eb;
      border-radius:6px;
      min-width:160px;
      z-index:10;
    }
    .culture-dropdown a,.projets-dropdown a{display:block;padding:8px 12px;font-size:14px;color:var(--text)}
    .culture-dropdown a:hover,.projets-dropdown a:hover{background:#f9fafb}
    .menu-culture:hover .culture-dropdown,.menu-projets:hover .projets-dropdown{display:block}

    /* Language flags — affichage pour mobile & desktop */
    .langs { display:flex; gap:6px; align-items:center; }
    .langs img.flag { width:22px; height:14px; cursor:pointer; display:inline-block; border-radius:2px; border:1px solid transparent; }
    .langs img.flag:focus { outline:2px solid #fff; outline-offset:2px; }
    .langs img.flag.active { outline:2px solid rgba(255,255,255,0.85); box-shadow:0 0 0 2px rgba(0,0,0,0.06) inset; border-color:rgba(0,0,0,0.06); }

    main{max-width:var(--maxw);margin:40px auto;padding:0 20px}
    section{margin-bottom:36px}
    h2{font-family:Merriweather,serif;font-size:20px;margin-bottom:12px}
    p{margin:0 0 14px 0}
    .muted{color:var(--muted)}

    form{margin-top:20px}
    label{display:block;font-size:14px;margin-bottom:4px}
    input,textarea{width:100%;padding:10px;border:1px solid #d1d5db;border-radius:4px;margin-bottom:12px;font-family:inherit}
    .controls{display:flex;gap:8px;align-items:center}
    .btn {
      display:inline-flex;align-items:center;gap:8px;
      padding:10px 16px;border-radius:6px;border:none;
      cursor:pointer;font-weight:600;
    }
    .btn-primary{background:var(--accent-cta);color:#fff}
    .btn-secondary{background:#f3f4f6;color:#111;border:1px solid #e5e7eb}
    .btn[disabled]{opacity:0.6;cursor:default}

    .meta{margin-top:8px;color:var(--muted);font-size:14px}

    footer{border-top:1px solid #e5e7eb;text-align:center;font-size:14px;color:var(--muted);padding:24px 20px}
    .hidden{display:none}
    @media (max-width:520px){
      .controls{flex-direction:column;align-items:stretch}
    }
  </style>
</head>
<body>

<header>
  <div class="wrap top">
    <h1>Blog de l'intranquilité</h1>

    <!-- conteneur droit : nav + langues -->
    <div style="display:flex;align-items:center;gap:16px">

      <nav>
        <a href="#" onclick="showHome()">Accueil</a>
        <a href="articles.html">Articles</a>

        <!-- PROJETS -->
        <div class="menu-projets">
          <a href="#" class="projets-btn">Projets ▾</a>
          <div class="projets-dropdown">
            <a href="projets-libres-pensees.html">Libres Pensées</a>
            <a href="#">Bref</a>
            <a href="droit-UE.html">Droit de l'UE</a>
          </div>
        </div>

        <!-- CULTURE -->
        <div class="menu-culture">
          <a href="#" class="culture-btn">Culture ▾</a>
          <div class="culture-dropdown">
            <a href="culture-films.html">Films</a>
            <a href="culture-livres.html">Livres</a>
            <a href="culture-musiques.html">Musiques</a>
          </div>
        </div>
      </nav>

      <div class="langs" role="navigation" aria-label="Choix de la langue">
        <img src="https://flagcdn.com/w20/fr.png" data-lang="fr" alt="Français" class="flag" role="button" tabindex="0">
        <img src="https://flagcdn.com/w20/gb.png" data-lang="en" alt="English" class="flag" role="button" tabindex="0">
        <img src="https://flagcdn.com/w20/pt.png" data-lang="pt" alt="Português" class="flag" role="button" tabindex="0">
      </div>
    </div>
  </div>
</header>

<main>
  <!-- HOME CONTENT ONLY -->
  <section id="home">

    <div data-lang="fr" class="lang-block">
      <h2>Présentation</h2>
      <p>Vous êtes prêts pour le voyage vers le pays des réflexions et discussions futures de Maceo Leal, vêtu d'une chemise hawaïenne déboutonnée, par une température de trente degrés et une humidité relative de soixante-dix pour cent.</p>
      <h2>Contributions</h2>
      <p class="muted">Les lecteurs peuvent proposer des articles, des projets ou des suggestions culturelles via le formulaire ci-dessous.</p>
    </div>

    <div data-lang="en" class="lang-block hidden">
      <h2>About</h2>
      <p>You are on board for a journey into the land of future reflections and discussions
by Maceo Leal, wearing an unbuttoned Hawaiian shirt, in temperatures of
thirty degrees and relative humidity of seventy per cent.</p>
      
      <h2>Contributions</h2>
      <p class="muted">Readers are welcome to submit articles, projects, or cultural suggestions using the form below.</p>
    </div>

    <div data-lang="pt" class="lang-block hidden">
      <h2>Apresentação</h2>
      <p>Você está a bordo para a viagem ao país das reflexões e discussões futuras
de Maceo Leal, com uma camisa havaiana desabotoada, sob uma temperatura de
trinta graus e uma humidade relativa de setenta por cento.</p>
      <h2>Contribuições</h2>
      <p class="muted">Os leitores podem enviar artigos, projetos ou sugestões culturais através do formulário abaixo.</p>
    </div>

    <form id="contact-form" class="proposal-form" aria-label="Formulaire de contact">
      <input type="hidden" name="section" value="contacts">
      <label for="cf-name" class="hidden">Nom</label>
      <input name="pseudo" id="cf-name" placeholder="Nom" required aria-required="true">

      <label for="cf-email" class="hidden">Email</label>
      <input name="email" id="cf-email" type="email" placeholder="Email" required aria-required="true">

      <label for="cf-message" class="hidden">Message</label>
      <textarea name="message" id="cf-message" rows="5" placeholder="Message" required aria-required="true"></textarea>

      <div class="controls">
        <!-- Bouton principal : envoi / sauvegarde -->
        <button type="submit" id="cf-submit" class="btn btn-primary" aria-live="polite">
          Envoyer
        </button>
      </div>

      <p id="cf-result" class="meta" role="status" aria-live="polite"></p>
    </form>

  </section>
</main>

<footer>
  © <span id="year"></span> — Blog personnel
</footer>

<script>
  // Met à jour l'année dans le footer
  document.getElementById('year').textContent = new Date().getFullYear();

  // Fonction pour scroller en haut
  function showHome(){ window.scrollTo({top:0,behavior:'smooth'}) }

  // Gestion des langues avec localStorage + accessibilité
  (function() {
    const LANG_KEY = 'blog_lang';

    function setLang(lang) {
      document.querySelectorAll('.lang-block').forEach(el => {
        el.classList.toggle('hidden', el.dataset.lang !== lang);
      });
      document.querySelectorAll('.langs img[data-lang]').forEach(img => {
        const isActive = (img.dataset.lang === lang);
        img.classList.toggle('active', isActive);
        img.setAttribute('aria-pressed', isActive ? 'true' : 'false');
      });
      document.documentElement.lang = lang;
      try { localStorage.setItem(LANG_KEY, lang); } catch (e) { console.warn('localStorage inaccessible :', e); }
    }

    function initFlagListeners() {
      document.querySelectorAll('.langs img[data-lang]').forEach(img => {
        img.addEventListener('click', () => setLang(img.dataset.lang));
        img.addEventListener('keydown', (e) => {
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            setLang(img.dataset.lang);
          }
        });
      });
    }

    document.addEventListener('DOMContentLoaded', () => {
      initFlagListeners();
      const stored = (function(){ try { return localStorage.getItem(LANG_KEY); } catch(e){ return null; } })();
      const initial = stored || document.documentElement.lang || 'fr';
      setLang(initial);
    });
  })();
</script>

<script>
/* === Configuration ===
   Remplacez ces valeurs par les vôtres :
   - WORKER_URL : endpoint Cloudflare Worker (ex: "https://mon-worker.example.workers.dev")
   - OWNER_EMAIL : adresse email du propriétaire pour le bouton "Me contacter"
*/
const WORKER_URL = "https://steep-dawn-b94d.ettae634.workers.dev"; // <-- remplacez par votre Worker si vous en avez un
const OWNER_EMAIL = "maceo@example.com"; // <-- remplacez par votre adresse email réelle

// Utilitaire : formate un timestamp lisible pour le nom de fichier
function filenameTimestamp() {
  return new Date().toISOString().replace(/[:.]/g, "-");
}

// Sauvegarde locale : crée et déclenche le téléchargement d'un fichier JSON
function saveLocally(payload) {
  try {
    const blob = new Blob([JSON.stringify(payload, null, 2)], { type: "application/json" });
    const safeName = (payload.pseudo || "anonyme").replace(/[^\w\-]/g, "_").slice(0, 60) || "anonyme";
    const filename = `contact-${safeName}-${filenameTimestamp()}.json`;
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    a.remove();
    URL.revokeObjectURL(url);
    return true;
  } catch (err) {
    console.error("Erreur lors de la sauvegarde locale :", err);
    return false;
  }
}

// Envoi vers le serveur avec timeout + parsing JSON
async function postToWorker(url, payload, timeout = 8000) {
  const trimmed = (url || "").trim();
  if (!trimmed || trimmed.includes("TON-WORKER")) {
    return { ok: false, reason: "no-worker-configured" };
  }

  // Forcer la requête vers la racine '/' du worker (assure pathname '/')
  const endpoint = trimmed.replace(/\/+$/, "") + "/";

  const controller = new AbortController();
  const id = setTimeout(() => controller.abort(), timeout);

  try {
    const res = await fetch(endpoint, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload),
      signal: controller.signal
    });
    clearTimeout(id);

    const text = await res.text().catch(() => "");
    let json = null;
    try { json = text ? JSON.parse(text) : null; } catch (e) { json = null; }

    return { ok: res.ok, status: res.status, json, text };
  } catch (err) {
    clearTimeout(id);
    return { ok: false, reason: err.name === "AbortError" ? "timeout" : err.message };
  }
}

// Encodage mailto
function buildMailtoLink(email, subject, body) {
  const s = encodeURIComponent(subject || "");
  const b = encodeURIComponent(body || "");
  return `mailto:${encodeURIComponent(email)}?subject=${s}&body=${b}`;
}

// Gestion du formulaire
(function() {
  const form = document.getElementById("contact-form");
  const nameEl = document.getElementById("cf-name");
  const emailEl = document.getElementById("cf-email");
  const msgEl = document.getElementById("cf-message");
  const submitBtn = document.getElementById("cf-submit");
  const mailBtn = document.getElementById("cf-mailto"); // peut être null si non présent
  const resultEl = document.getElementById("cf-result");

  // Si bouton "Me contacter" est présent, active son comportement
  if (mailBtn) {
    mailBtn.addEventListener("click", (ev) => {
      ev.preventDefault();
      const pseudo = (nameEl.value || "Anonyme").trim();
      const email = (emailEl.value || "").trim();
      const message = (msgEl.value || "").trim();
      const subject = `Message depuis votre blog — ${pseudo}`;
      const body = `Nom: ${pseudo}\nEmail de l'expéditeur: ${email}\n\nMessage:\n${message}`;
      const mailto = buildMailtoLink(OWNER_EMAIL, subject, body);
      window.location.href = mailto;
    });
  }

  // soumission principale
  form.addEventListener("submit", async (e) => {
    e.preventDefault();

    const pseudo = (nameEl.value || "Anonyme").trim();
    const email = (emailEl.value || "").trim();
    const message = (msgEl.value || "").trim();

    // validation simple côté client
    if (!email || !message) {
      resultEl.textContent = "Veuillez renseigner au minimum l'email et le message.";
      resultEl.style.color = "var(--accent-cta)";
      return;
    }

    const payload = {
      title: "Contact",          // requis par le worker
      pseudo,
      email,                     // utile en plus (worker ignore mais on stocke)
      content: message,
      section: "contacts",
      timestamp: new Date().toISOString()
    };

    // Mise à jour UI : disable boutons (si existants)
    submitBtn.disabled = true;
    if (mailBtn) mailBtn.disabled = true;
    const prevSubmitText = submitBtn.textContent;
    submitBtn.textContent = "Envoi…";
    resultEl.textContent = "";

    // Tentative d'envoi serveur (si WORKER_URL fourni)
    const serverResp = await postToWorker(WORKER_URL, payload);

    // Cas réussite HTTP
    if (serverResp.ok) {
      // si le worker renvoie un JSON { success: true } on affiche succès, sinon on vérifie le JSON
      const successFlag = serverResp.json && (serverResp.json.success === true);
      if (successFlag || serverResp.status === 200) {
        resultEl.textContent = "Message envoyé et enregistré sur le serveur ✔";
        resultEl.style.color = "green";
        // vider le formulaire
        nameEl.value = "";
        emailEl.value = "";
        msgEl.value = "";
        submitBtn.disabled = false;
        if (mailBtn) mailBtn.disabled = false;
        submitBtn.textContent = prevSubmitText;
        return;
      } else {
        // réponse 200 mais content indique échec : on log et fallback
        console.warn("Worker returned non-success payload:", serverResp.json || serverResp.text);
      }
    } else {
      // erreur HTTP / timeout / réseau
      console.warn("Envoi au serveur échoué :", serverResp);
    }

    // Si on arrive ici -> sauvegarde locale en fallback
    const saved = saveLocally(payload);

    if (serverResp.reason && serverResp.reason !== "no-worker-configured") {
      // détail utile pour debug
      console.warn("Détail erreur serveur :", serverResp);
    }

    if (saved) {
      resultEl.textContent = (serverResp.reason === "no-worker-configured")
        ? "Aucun serveur configuré — votre message a été téléchargé en local (fichier JSON)."
        : "Le serveur est indisponible — votre message a été sauvegardé en local (fichier JSON).";
      resultEl.style.color = "orange";
      // vider le formulaire
      nameEl.value = "";
      emailEl.value = "";
      msgEl.value = "";
    } else {
      resultEl.textContent = "Erreur : impossible d'enregistrer le message localement.";
      resultEl.style.color = "crimson";
    }

    submitBtn.disabled = false;
    if (mailBtn) mailBtn.disabled = false;
    submitBtn.textContent = prevSubmitText;
  });
})();
</script>


</body>
</html>

