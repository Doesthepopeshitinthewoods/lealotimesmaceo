<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Blog de l'intranquilité</title>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=Merriweather:wght@300;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#ffffff; --text:#111827; --muted:#6b7280; --accent:#1f2937; --maxw:960px; --ui-radius:8px;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,Arial;line-height:1.6}
    a{color:var(--accent);text-decoration:none}
    a:hover{text-decoration:underline}

    header{ background:#8b0000; border-bottom:1px solid #7a0000; }
    .wrap{max-width:var(--maxw);margin:0 auto;padding:18px 20px}
    .top{display:flex;align-items:center;justify-content:space-between;gap:16px}
    h1{ margin:0;font-family:Merriweather,serif;font-size:22px;font-weight:700;color:#ffffff; }

    nav{ display:flex; gap:14px; align-items:center; }
    nav a, nav button { font-size:14px; color:#f3f4f6; background:none;border:0;cursor:pointer;padding:0 }
    nav a:hover, nav button:hover { text-decoration:underline }
    nav a.small-muted{ color:var(--muted) }

    /* Dropdown menus (culture / projets / langue) */
    .dropdown { position:relative; display:inline-block; }
    .dropdown-menu {
      display:none; position:absolute; top:100%; left:0; background:#fff; border:1px solid #e5e7eb; border-radius:8px; padding:6px;
      box-shadow:0 10px 30px rgba(0,0,0,.12); z-index:999;
      min-width:180px;
    }
    .dropdown-menu a, .dropdown-menu button { display:flex; align-items:center; gap:10px; padding:8px 10px; border-radius:6px; background:transparent; border:0; cursor:pointer; width:100%; text-align:left; color:var(--text) }
    .dropdown-menu a:hover, .dropdown-menu button:hover { background:#f3f4f6; }

    /* Language dropdown label */
    .lang-flag { width:28px; height:18px; border-radius:4px; display:inline-block; vertical-align:middle; margin-right:8px; }
    .lang-short { color:#fff; font-size:14px; margin-left:6px; }

    /* show dropdown when parent has .open */
    .dropdown.open > .dropdown-menu { display:block; }

    /* Accessibility focus */
    .dropdown-menu button:focus, .dropdown-menu a:focus { outline:2px solid rgba(59,130,246,.18); outline-offset:2px }

    /* layout main */
    main{max-width:var(--maxw);margin:36px auto;padding:0 20px}
    section{margin-bottom:36px}
    h2{font-family:Merriweather,serif;font-size:20px;margin-bottom:10px}
    p{margin:0 0 14px 0}
    .muted{color:var(--muted)}

    form{margin-top:20px}
    label{display:block;font-size:14px;margin-bottom:6px}
    input,textarea{width:100%;padding:10px;border:1px solid #d1d5db;border-radius:6px;margin-bottom:12px;font-family:inherit}
    button{padding:8px 14px;background:var(--accent);color:white;border:none;border-radius:6px;cursor:pointer}

    footer{border-top:1px solid #e5e7eb;text-align:center;font-size:14px;color:var(--muted);padding:20px}

    .back-btn { background:none;border:1px solid #e5e7eb;padding:6px 10px;border-radius:6px;cursor:pointer }
  </style>
</head>
<body>

<header>
  <div class="wrap top">
    <h1>Blog de l'intranquilité</h1>
    <div style="display:flex;align-items:center;gap:12px">
      <nav>
        <a href="#" class="small-muted" data-i18="nav.home" onclick="showHome();return false">Accueil</a>
        <a href="#" data-i18="nav.articles" onclick="showAlert('articles');return false">Articles</a>

        <div class="dropdown menu-projets">
          <button aria-haspopup="true" aria-expanded="false" data-i18="nav.projects">Projets ▾</button>
          <div class="dropdown-menu projets-dropdown" role="menu" aria-label="Projets menu">
            <a href="#projects-free" data-i18="nav.projects_free">Libres pensées</a>
            <a href="#projects-bref" data-i18="nav.projects_bref">Bref</a>
          </div>
        </div>

        <div class="dropdown menu-culture">
          <button aria-haspopup="true" aria-expanded="false" data-i18="nav.culture">Culture ▾</button>
          <div class="dropdown-menu culture-dropdown" role="menu" aria-label="Culture menu">
            <a href="#culture-films" data-i18="culture.films">Films</a>
            <a href="#culture-livres" data-i18="culture.books">Livres</a>
            <a href="#culture-musiques" data-i18="culture.music">Musiques</a>
          </div>
        </div>

        <!-- NEW: explicit Language section in nav -->
        <div class="dropdown" id="lang-dropdown" aria-haspopup="true">
          <button id="lang-toggle-btn" aria-expanded="false" style="display:inline-flex;align-items:center;gap:8px;">
            <img src="https://flagcdn.com/w20/fr.png" class="lang-flag" id="nav-main-flag" alt="Français">
            <span class="lang-short" id="nav-lang-code">FR ▾</span>
          </button>

          <div class="dropdown-menu" id="lang-menu" role="menu" aria-label="Langues disponibles">
            <button data-lang="fr" class="lang-select" role="menuitem">
              <img src="https://flagcdn.com/w40/fr.png" class="lang-flag" alt="Français"><span>Français</span>
            </button>
            <button data-lang="en" class="lang-select" role="menuitem">
              <img src="https://flagcdn.com/w40/gb.png" class="lang-flag" alt="English"><span>English</span>
            </button>
            <button data-lang="pt" class="lang-select" role="menuitem">
              <img src="https://flagcdn.com/w40/pt.png" class="lang-flag" alt="Português"><span>Português</span>
            </button>
          </div>
        </div>
      </nav>
    </div>
  </div>
</header>

<main>
  <!-- HOME CONTENT -->
  <section id="home">
    <div data-lang="fr">
      <h2>Présentation</h2>
      <p>Bienvenue — version française du blog.</p>
      <h2>Contributions</h2>
      <p class="muted">Les lecteurs peuvent proposer des articles ou projets via le formulaire ci-dessous.</p>
    </div>

    <div data-lang="en" class="hidden">
      <h2>About</h2>
      <p>Welcome — English version of the blog.</p>
      <h2>Contributions</h2>
      <p class="muted">Readers can submit articles or projects via the form below.</p>
    </div>

    <div data-lang="pt" class="hidden">
      <h2>Apresentação</h2>
      <p>Bem-vindo — versão em português do blog.</p>
      <h2>Contribuições</h2>
      <p class="muted">Leitores podem enviar artigos ou projetos através do formulário abaixo.</p>
    </div>

    <form id="contact-form" onsubmit="return handleSubmit(event)">
      <label data-i18="form.nameLabel" for="name">Nom</label>
      <input id="name" name="name">
      <label data-i18="form.emailLabel" for="email">Email</label>
      <input id="email" name="email">
      <label data-i18="form.messageLabel" for="message">Message</label>
      <textarea id="message" name="message" rows="5"></textarea>
      <button type="submit" data-i18="form.submit">Envoyer</button>
    </form>
  </section>

  <!-- Dynamic pages appended here -->
</main>

<footer>
  <div id="footer-copy">© <span id="year"></span> — Blog personnel</div>
</footer>

<script>
/* ---------- Translations ---------- */
const translations = {
  fr: {
    "nav.home":"Accueil","nav.articles":"Articles","nav.projects":"Projets ▾","nav.projects_free":"Libres pensées","nav.projects_bref":"Bref",
    "nav.culture":"Culture ▾","culture.films":"Films","culture.books":"Livres","culture.music":"Musiques",
    "projects.free":"Libres pensées","projects.bref":"Bref",
    "form.nameLabel":"Nom","form.emailLabel":"Email","form.messageLabel":"Message","form.submit":"Envoyer",
    "footer.copy":"© {YEAR} — Blog personnel",
    alerts:{articles:"Section Articles à venir",projects:"Projets — à venir",free_thoughts:"Libres pensées – à venir"}
  },
  en: {
    "nav.home":"Home","nav.articles":"Articles","nav.projects":"Projects ▾","nav.projects_free":"Free thoughts","nav.projects_bref":"Brief",
    "nav.culture":"Culture ▾","culture.films":"Films","culture.books":"Books","culture.music":"Music",
    "projects.free":"Free thoughts","projects.bref":"Brief",
    "form.nameLabel":"Name","form.emailLabel":"Email","form.messageLabel":"Message","form.submit":"Send",
    "footer.copy":"© {YEAR} — Personal blog",
    alerts:{articles:"Articles section coming soon",projects:"Projects — coming soon",free_thoughts:"Free thoughts — coming soon"}
  },
  pt: {
    "nav.home":"Início","nav.articles":"Artigos","nav.projects":"Projetos ▾","nav.projects_free":"Pensamentos livres","nav.projects_bref":"Breve",
    "nav.culture":"Cultura ▾","culture.films":"Filmes","culture.books":"Livros","culture.music":"Músicas",
    "projects.free":"Pensamentos livres","projects.bref":"Breve",
    "form.nameLabel":"Nome","form.emailLabel":"Email","form.messageLabel":"Mensagem","form.submit":"Enviar",
    "footer.copy":"© {YEAR} — Blog pessoal",
    alerts:{articles:"Seção de artigos em breve",projects:"Projetos — em breve",free_thoughts:"Pensamentos livres – em breve"}
  }
};

function applyI18n(lang){
  document.querySelectorAll('[data-i18]').forEach(el=>{
    const key = el.getAttribute('data-i18');
    const text = translations[lang] && translations[lang][key] ? translations[lang][key] : '';
    if(text) el.textContent = text.replace('{YEAR}', new Date().getFullYear());
  });
  const footerEl = document.getElementById('footer-copy');
  if(footerEl && translations[lang] && translations[lang]['footer.copy']) {
    footerEl.textContent = translations[lang]['footer.copy'].replace('{YEAR}', new Date().getFullYear());
  }
}

/* ---------- Language control (explicit nav section) ---------- */
(function LanguageNav(){
  const LANGS = ['fr','en','pt'];
  const dropdown = document.getElementById('lang-dropdown');
  const menu = document.getElementById('lang-menu');
  const toggleBtn = document.getElementById('lang-toggle-btn');
  const mainFlag = document.getElementById('nav-main-flag');
  const mainCode = document.getElementById('nav-lang-code');

  function setLang(lang){
    if (!LANGS.includes(lang)) return;
    // show/hide blocks
    document.querySelectorAll('[data-lang]').forEach(el=> el.classList.toggle('hidden', el.dataset.lang !== lang));
    // update nav indicator
    const chosen = menu.querySelector('[data-lang="'+lang+'"] img');
    if (chosen) {
      // reduce to small for nav
      let src = chosen.src;
      src = src.replace('/w80/','/w20/').replace('/w40/','/w20/');
      mainFlag.src = src;
      mainFlag.alt = chosen.alt || lang;
      mainCode.textContent = lang.toUpperCase() + ' ▾';
    }
    // active style on menu items
    menu.querySelectorAll('[data-lang]').forEach(el=> el.classList.toggle('active', el.getAttribute('data-lang') === lang));
    // i18n labels
    applyI18n(lang);
    document.documentElement.lang = lang;
    try { localStorage.setItem('site-lang', lang); } catch(e){}
    // refresh dynamic page content language (if open)
    if (typeof refreshOpenPageForLang === 'function') refreshOpenPageForLang(lang);
  }

  // open/close dropdown on toggle click
  toggleBtn.addEventListener('click', (e)=>{
    e.preventDefault();
    dropdown.classList.toggle('open');
    toggleBtn.setAttribute('aria-expanded', dropdown.classList.contains('open'));
  });

  // click on language rows
  menu.querySelectorAll('.lang-select').forEach(btn=>{
    btn.addEventListener('click', (e)=>{
      const lang = btn.getAttribute('data-lang');
      setLang(lang);
      dropdown.classList.remove('open');
      toggleBtn.setAttribute('aria-expanded','false');
    });
  });

  // keyboard accessibility inside menu
  menu.querySelectorAll('.lang-select').forEach((btn, idx, list)=>{
    btn.setAttribute('tabindex','0');
    btn.addEventListener('keydown', (e)=>{
      if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); btn.click(); }
      if (e.key === 'ArrowDown') { e.preventDefault(); (list[(idx+1)%list.length]).focus(); }
      if (e.key === 'ArrowUp') { e.preventDefault(); (list[(idx-1+list.length)%list.length]).focus(); }
      if (e.key === 'Escape') { dropdown.classList.remove('open'); toggleBtn.focus(); }
    });
  });

  // close when clicking outside
  document.addEventListener('click', (e)=>{
    if (!dropdown.contains(e.target)) { dropdown.classList.remove('open'); toggleBtn.setAttribute('aria-expanded','false'); }
  });

  // restore saved or default
  const saved = (function(){ try { return localStorage.getItem('site-lang'); } catch(e){ return null; } })();
  const initial = saved || document.documentElement.lang || 'fr';
  window.addEventListener('DOMContentLoaded', ()=> setLang(initial));
})();

/* ---------- Simple dynamic page system (culture-* and projects-*) ---------- */
(function PageSystem(){
  function showHome(){
    const home = document.getElementById('home'); if (home) home.classList.remove('hidden');
    document.querySelectorAll('[data-page]').forEach(p => p.classList.add('hidden'));
    try { history.replaceState(null,'', location.pathname + location.search); } catch(e){}
  }
  window.showHome = showHome;

  function openPage(pageId){
    if(!pageId) return;
    const home = document.getElementById('home'); if (home) home.classList.add('hidden');

    let page = document.querySelector('[data-page="'+pageId+'"]');
    if (!page) { page = createPage(pageId); document.querySelector('main').appendChild(page); }
    document.querySelectorAll('[data-page]').forEach(p => p.classList.add('hidden'));
    page.classList.remove('hidden');

    try { location.hash = pageId; } catch(e){}
    const lang = document.documentElement.lang || 'fr';
    loadPageContent(pageId, lang);
  }
  window.openPage = openPage;

  function createPage(pageId){
    const section = document.createElement('section');
    section.setAttribute('data-page', pageId);
    section.style.marginBottom = '36px';

    const header = document.createElement('div');
    header.style.display='flex'; header.style.alignItems='center'; header.style.gap='12px'; header.style.marginBottom='12px';

    const back = document.createElement('button'); back.textContent='←'; back.className='back-btn';
    back.addEventListener('click',(e)=>{ e.preventDefault(); showHome(); });

    const title = document.createElement('h2'); title.style.margin='0'; title.dataset.titleFor = pageId;

    header.appendChild(back); header.appendChild(title);

    const label = document.createElement('label'); label.textContent='Contenu (modifiable)'; label.style.display='block'; label.style.marginTop='8px';
    const textarea = document.createElement('textarea'); textarea.rows=12; textarea.style.width='100%'; textarea.style.padding='10px'; textarea.style.border='1px solid #d1d5db'; textarea.style.borderRadius='6px'; textarea.style.marginTop='6px';
    textarea.setAttribute('aria-label','Éditeur');

    const saveBtn = document.createElement('button'); saveBtn.textContent='Enregistrer'; saveBtn.style.marginTop='8px';
    saveBtn.addEventListener('click',(e)=>{ e.preventDefault(); const lang = document.documentElement.lang||'fr'; const key='page:'+pageId+':'+lang; try{ localStorage.setItem(key, textarea.value);}catch(e){}; renderPreview(pageId, textarea.value); alert(lang==='fr'?'Enregistré':lang==='en'?'Saved':'Gravado'); });

    const previewLabel = document.createElement('div'); previewLabel.style.marginTop='14px'; previewLabel.style.fontWeight='600'; previewLabel.textContent='Aperçu';
    const preview = document.createElement('div'); preview.style.marginTop='8px'; preview.style.padding='12px'; preview.style.border='1px solid #e5e7eb'; preview.style.borderRadius='6px'; preview.style.minHeight='40px';
    preview.dataset.previewFor = pageId;

    section.appendChild(header); section.appendChild(label); section.appendChild(textarea); section.appendChild(saveBtn); section.appendChild(previewLabel); section.appendChild(preview);

    section.classList.add('hidden'); section._editor = textarea; section._preview = preview; section._titleEl = title;
    updatePageTitle(section,pageId);
    return section;
  }

  function updatePageTitle(section, pageId){
    const lang = document.documentElement.lang || 'fr';
    const key = pageId.replace('-', '.'); // e.g. culture-films -> culture.films
    const title = (translations[lang] && translations[lang][key]) ? translations[lang][key] : pageId;
    if (section && section._titleEl) section._titleEl.textContent = title;
  }

  function renderPreview(pageId,content){
    const preview = document.querySelector('[data-preview-for="'+pageId+'"]');
    if(preview){ const safe = escapeHtml(content||'').replace(/\n/g,'<br>'); preview.innerHTML = safe; }
  }

  function loadPageContent(pageId,lang){
    const page = document.querySelector('[data-page="'+pageId+'"]'); if(!page) return;
    updatePageTitle(page,pageId);
    const key='page:'+pageId+':'+lang;
    const saved=(function(){ try{ return localStorage.getItem(key);}catch(e){return''; } })()||'';
    if(page._editor) page._editor.value=saved;
    renderPreview(pageId,saved);
  }

  function refreshOpenPageForLang(lang){
    const open = Array.from(document.querySelectorAll('[data-page]')).find(p => !p.classList.contains('hidden'));
    if(open){ const pageId = open.getAttribute('data-page'); loadPageContent(pageId, lang); }
    document.querySelectorAll('[data-page]').forEach(p => updatePageTitle(p, p.getAttribute('data-page')));
  }
  window.refreshOpenPageForLang = refreshOpenPageForLang;

  function escapeHtml(str){ return String(str||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#039;'); }

  // intercept clicks on anchors #culture-* or #projects-*
  document.addEventListener('click', function(e){
    const a = e.target.closest('a');
    if(!a) return;
    const href = a.getAttribute('href') || '';
    if (href.startsWith('#culture-') || href.startsWith('#projects-')) {
      e.preventDefault();
      openPage(href.slice(1));
    }
  }, false);

  // open on hash load
  window.addEventListener('DOMContentLoaded', ()=> {
    if (location.hash && (location.hash.startsWith('#culture-') || location.hash.startsWith('#projects-'))) {
      openPage(location.hash.slice(1));
    }
  });

})(); // PageSystem end

/* ---------- App helpers ---------- */
(function AppHelpers(){
  const yearEl = document.getElementById('year'); if (yearEl) yearEl.textContent = new Date().getFullYear();

  window.showAlert = function(key){
    const lang = document.documentElement.lang || 'fr';
    const msg = translations[lang] && translations[lang].alerts && translations[lang].alerts[key] ? translations[lang].alerts[key] : '';
    if(msg) alert(msg);
  };

  window.handleSubmit = function(e){
    e.preventDefault();
    const lang = document.documentElement.lang || 'fr';
    const messages = { fr:'Merci — message envoyé (simulé).', en:'Thanks — message sent (simulated).', pt:'Obrigado — mensagem enviada (simulada).' };
    alert(messages[lang] || messages.fr);
    return false;
  };
})();
</script>
</body>
</html>
